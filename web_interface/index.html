<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Robot Controller + Camera</title>
  <script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>
  <!-- å¤–éƒ¨CSSãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>ORCAä¸¸å±±ãƒ­ãƒœãƒƒãƒˆ</h1>
    <div id="wrapper">
        <div id="controll-block">
            <h1>ä½•ã‹å…¥ã‚‹</h1>
            <h2>ãƒ‡ã‚¶ã‚¤ãƒ³èª¿æ•´ã¨ä»–ãƒˆãƒ”ãƒƒã‚¯ã¨ã‚µãƒ¼ãƒ“ã‚¹ã¯ã“ã®å¾Œè¿½åŠ ã—ã¾ã™</h2>
        </div>

        <div id="camera-block">
            <div class="camera-box">
                <div id="status">çŠ¶æ…‹: æœªç¢ºèª</div>
                <video id="camera" autoplay muted></video>

                <div class="button-group">
                    <button onclick="sendControlState(0)">Manual</button>
                    <button onclick="sendControlState(1)">Auto</button>
                </div>
            </div>
            <div class="camera-box">
                <div id="status">çŠ¶æ…‹: æœªç¢ºèª</div>
                <video id="camera" autoplay muted></video>

                <div class="button-group">
                    <button onclick="sendControlState(0)">Manual</button>
                    <button onclick="sendControlState(1)">Auto</button>
                </div>
            </div>
            <div class="camera-box">
                <div id="status">çŠ¶æ…‹: æœªç¢ºèª</div>
                <video id="camera" autoplay muted></video>

                <div class="button-group">
                    <button onclick="sendControlState(0)">Manual</button>
                    <button onclick="sendControlState(1)">Auto</button>
                </div>
            </div>
        </div>
    </div>



  <script>
    // ã‚«ãƒ¡ãƒ©è¡¨ç¤ºå‡¦ç†
    const video = document.getElementById('camera');
    navigator.mediaDevices.getUserMedia({ video: true, audio: false })
      .then((stream) => {
        video.srcObject = stream;
      })
      .catch((err) => {
        console.error("ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸ:", err);
      });

    // ROSé€£æºå‡¦ç†
    const ros = new ROSLIB.Ros({ url: "ws://localhost:9090" });

    ros.on('connection', () => console.log("âœ… Connected to rosbridge"));
    ros.on('error', (err) => console.error("âŒ Error:", err));
    ros.on('close', () => console.log("ğŸ”Œ Connection closed."));

    const isManualTopic = new ROSLIB.Topic({
      ros: ros,
      name: '/orca_00/control_state',
      messageType: 'std_msgs/msg/Int32'
    });

    function sendControlState(value) {
      const msg = new ROSLIB.Message({ data: value });
      isManualTopic.publish(msg);
      console.log("ğŸ“¤ Sent is_manual:", value);
    }
    // is_enable service client
    const isEnableService = new ROSLIB.Service({
      ros: ros,
      name: '/orca_00/enable',
      serviceType: 'std_srvs/srv/Empty'
    });

    // çŠ¶æ…‹ã‚’å–å¾—ã—ã¦UIæ›´æ–°
    function updateStatus() {
      const request = new ROSLIB.ServiceRequest({});
      isEnableService.callService(request, (result) => {
        // std_srvs/Empty ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’æŒãŸãªã„ãŸã‚ã€ä½•ã‹å‡ºåŠ›ã—ãŸã„å ´åˆã¯æ‹¡å¼µãŒå¿…è¦
        document.getElementById("status").innerText = "çŠ¶æ…‹: enableï¼ˆå¿œç­”ã‚ã‚Šï¼‰";
      }, (error) => {
        document.getElementById("status").innerText = "çŠ¶æ…‹: ç„¡åŠ¹ or å¿œç­”ãªã—";
        console.warn("Service call failed:", error);
      });
    }

    setInterval(updateStatus, 10000);
  </script>
</body>
</html>
